name: Terraform Validator
on: [push, pull_request]
defaults:
  run:
    shell: bash

jobs:
  terraform:
    name: Terraform
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@main

      - name: Setup
        uses: hashicorp/setup-terraform@master

      - name: Format Check
        run: "terraform fmt -diff -recursive -write=false && terraform fmt -check -recursive"

      - name: Validate
        run: ./.github/workflows/validator

      - name: Security Scan via checkov
        id: checkov
        uses: bridgecrewio/checkov-action@master

      - name: Security Scan via Triat
        uses: triat/terraform-security-scan@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
